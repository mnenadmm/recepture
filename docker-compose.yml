version : '3.7'
services:
  postgres: 
    container_name: postges_container
    hostname: postgres
    image: postgres:15
    restart: unless-stopped
    ports:
      - "5433:5432"
    volumes: 
      - ./baza/data:/var/lib/postgresql/data
      #- ./baza:/postgres
    networks:
      - mreza2
    env_file:
      - .env
  
  backend:
    build: # sudo docker build -f Dockerfile.novi  -t flask-backend .

      context: ./backend
      dockerfile: Dockerfile.novi
    image: flask-backend
    restart: unless-stopped
    ports:
      - '5000:5000'
    volumes:
       - ./backend:/app #celi folder backend prebacujemo u app u kontenjeru
    links:
      - postgres
    depends_on:
      - postgres
    networks:
      - mreza1 
      - mreza2

  front: # sudo docker build -t react-front-image .
    build: 
      context: ./client
      dockerfile: Dockerfile   #Dockerfile.txt  je bildovana verzija
    image: react-front-image
    ports:
      - '3000:3000'    #- '8080:80' ovo koristimo za bildovanu verziju
    restart: unless-stopped
    volumes: #mapirali smo src folder sa racunara u src kontenjara!!
       - ./client/src:/app/src
    networks:
      - mreza1
    depends_on:
      - postgres
      - backend
    #environment: #ova varijabla se mora koristiti samo za windows
    #  - WATCHPACK_POLLING=true

  pgadmin:
    image: dpage/pgadmin4
    depends_on:
      - postgres
    ports:
      - "5555:80"
    restart: unless-stopped
    networks:
      - mreza1   # Dodaj ovu mre≈æu
      - mreza2 
    env_file:
      - .env 
  nginx:
    image: nginx:latest
    container_name: nginx_proxy
    restart: unless-stopped
    ports:
      - "80:80"  # Preusmerava port 80 ka NGINX
    volumes:
           - ./nginx.conf:/etc/nginx/nginx.conf
           - ./client/build:/usr/share/nginx/html
    depends_on:
      - front  # Frontend zavisi od React aplikacije
      - backend  # Backend zavisi od Flask aplikacije
    networks:
      - mreza1
      - mreza2

networks:
  mreza1:
    name: mreza1
  mreza2:
    name: mreza2



    
  

  
      

    

  
   
  
  

  

    








   
  
    



  

    








   
  
    

